document.addEventListener('DOMContentLoaded', () => {
    // Translations
    const translations = {
        ar: {
            nav_home: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
            nav_about: 'Ø¹Ù†ÙŠ',
            nav_skills: 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
            nav_projects: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',
            nav_contact: 'Ø§ØªØµÙ„ Ø¨ÙŠ',
            hero_title: 'ALPHA',
            hero_desc: 'Ù…Ø²ÙŠØ¬ Ø¨ÙŠÙ† Ø§Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø±Ø³Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±.',
            btn_projects: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',
            btn_contact: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ',
            about_title: 'Ù…Ù† Ø£Ù†Ø§',
            about_text: 'Ø®Ø±ÙŠØ¬ ØªØ®ØµØµ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© Ø·Ù…ÙˆØ­ Ø­Ø§ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø§Ø³ØªØ± Ù…Ù‡Ù†ÙŠ. Ø£Ø¬Ù…Ø¹ Ø¨ÙŠÙ† Ø®Ù„ÙÙŠØ© ØµÙ„Ø¨Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠ. ÙÙ„Ø³ÙØªÙŠ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„ØªÙ‚Ø¯ÙŠÙ… ØªØ¬Ø§Ø±Ø¨ Ø³ÙŠØ§Ø­ÙŠØ© Ù„Ø§ ØªÙÙ†Ø³Ù‰ØŒ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.',
            skills_title: 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø®Ø¨Ø±Ø§Øª',
            skill_mgmt: 'Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©',
            skill_master: 'Ù…Ø§Ø³ØªØ± Ù…Ù‡Ù†ÙŠ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©',
            skill_intern: 'ØªØ±Ø¨Øµ ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø¨ÙÙ†Ø¯Ù‚ Ù…Ø§Ø±ÙŠÙˆØª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ',
            skill_law: 'Ù„ÙŠØ³Ø§Ù†Ø³ ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¹Ø§Ù…',
            skill_tech: 'Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
            skill_ai: 'Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI)',
            skill_marketing: 'Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ',
            skill_data: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (SPSS)',
            skill_finance: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù„ØºØ§Øª',
            skill_pricing: 'Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØ³Ø¹ÙŠØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (FinTech)',
            skill_english: 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (B2 Upper Intermediate)',
            skill_accounting: 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© (Simple Comptable)',
            projects_title: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
            project_alpha: 'Ù…Ù†ØµØ© Ø£Ù„ÙØ§ - ALPHA',
            project_alpha_desc: 'Ù…Ø´Ø±ÙˆØ¹ Ø±Ø§Ø¦Ø¯ Ù„Ø±Ù‚Ù…Ù†Ø© Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© ÙÙŠ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© Ù…ØªØ·ÙˆØ±Ø©.',
            project_coming_soon: 'Ù‚Ø±ÙŠØ¨Ø§Ù‹..',
            contact_title: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ',
            contact_name_placeholder: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
            contact_email_placeholder: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
            contact_msg_placeholder: 'Ø±Ø³Ø§Ù„ØªÙƒ',
            contact_send: 'Ø¥Ø±Ø³Ø§Ù„',
            footer_copy: 'Â© 2026 ALPHA- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©',
            page_title: 'ALPHA | Ù…Ù†ØµØ© Ø£Ù„ÙØ§ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©',
            lang_btn: 'English',
            blog_title: 'Ø¢Ø®Ø± Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª',
            loading: 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...',
            read_more: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯',
            no_blogs: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.'
        },
        en: {
            nav_home: 'Home',
            nav_about: 'About',
            nav_skills: 'Skills',
            nav_projects: 'Projects',
            nav_contact: 'Contact',
            hero_title: 'ALPHA',
            hero_desc: 'A fusion of Tourism and AI to shape the future of cultural tourism in Algeria.',
            btn_projects: 'View Projects',
            btn_contact: 'Contact Me',
            about_title: 'Who Am I',
            about_text: 'Ambitious Tourism Management graduate with a Professional Masterâ€™s degree. I combine a solid background in tourism with technological innovation. My philosophy relies on using Artificial Intelligence and Digital Marketing to provide unforgettable tourism experiences, while ensuring financial and legal efficiency for projects.',
            skills_title: 'Skills & Experience',
            skill_mgmt: 'Professional Specializations',
            skill_master: 'Professional Master in Tourism Management',
            skill_intern: 'HR Internship at Marriott International',
            skill_law: 'Bachelor in Public Law',
            skill_tech: 'Technology & AI',
            skill_ai: 'Elements of AI',
            skill_marketing: 'Digital Marketing Fundamentals',
            skill_data: 'Data Analysis (SPSS)',
            skill_finance: 'Finance & Languages',
            skill_pricing: 'Business Management & Pricing (FinTech)',
            skill_english: 'English (B2 Upper Intermediate)',
            skill_accounting: 'Accounting (Simple Comptable)',
            projects_title: 'Current Projects',
            project_alpha: 'ALPHA Platform',
            project_alpha_desc: 'A pioneering project to digitize cultural and historical tourism in Eastern Algeria using advanced technical solutions.',
            project_coming_soon: 'Coming Soon..',
            contact_title: 'Contact Me',
            contact_name_placeholder: 'Full Name',
            contact_email_placeholder: 'Email Address',
            contact_msg_placeholder: 'Your Message',
            contact_send: 'Send',
            footer_copy: 'Â© 2026 ALPHA- All Rights Reserved',
            page_title: 'ALPHA | Digital Platform',
            lang_btn: 'Ø¹Ø±Ø¨ÙŠ',
            blog_title: 'Latest Articles',
            loading: 'Loading articles...',
            read_more: 'Read More',
            no_blogs: 'No articles found.'
        }
    };

    // DOM Elements
    const themeToggle = document.getElementById('theme-toggle');
    const langToggle = document.getElementById('lang-toggle');
    const body = document.body;
    const htmlElement = document.documentElement;

    // --- Theme Logic ---
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('light-theme');
            updateThemeIcon();
            localStorage.setItem('theme', body.classList.contains('light-theme') ? 'light' : 'dark');
        });

        function updateThemeIcon() {
            themeToggle.textContent = body.classList.contains('light-theme') ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Initialize Theme
        if (localStorage.getItem('theme') === 'light') {
            body.classList.add('light-theme');
            updateThemeIcon();
        }
    }

    // --- Language Logic ---
    if (langToggle) {
        let currentLang = localStorage.getItem('lang') || 'ar'; // Default to Arabic

        const updateLanguage = (lang) => {
            // Update HTML attributes
            htmlElement.lang = lang;
            htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            // Update Page Title
            if (translations[lang]['page_title']) {
                document.title = translations[lang]['page_title'];
            }

            // Update Text Content
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });

            // Update Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });

            // Update Toggle Button Text
            langToggle.textContent = translations[lang]['lang_btn'];

            // Font Adjustment
            if (lang === 'en') {
                document.documentElement.style.setProperty('--font-main', "'Inter', 'Tajawal', sans-serif");
            } else {
                document.documentElement.style.setProperty('--font-main', "'Tajawal', sans-serif");
            }

            // Save preference
            localStorage.setItem('lang', lang);
            currentLang = lang;
        };

        // Initialize Language
        updateLanguage(currentLang);

        langToggle.addEventListener('click', () => {
            const newLang = currentLang === 'ar' ? 'en' : 'ar';
            updateLanguage(newLang);
        });
    }

    // Scroll Animations
    const observerOptions = {
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-visible');
            }
        });
    }, observerOptions);

    document.querySelectorAll('.section').forEach(section => {
        observer.observe(section);
    });

    // Smooth Scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });

    // ===== EmailJS Configuration =====
    const EMAILJS_CONFIG = {
        publicKey: 'mRqoThq2EYlAxZKzl',      // Your Public Key
        serviceId: 'service_3t8m3ta',        // Your Service ID
        templateId: 'template_tiqhxod'       // Your Template ID
    };

    // Initialize EmailJS
    if (typeof emailjs !== 'undefined') {
        emailjs.init({
            publicKey: EMAILJS_CONFIG.publicKey
        });
        console.log('âœ… EmailJS initialized successfully');
        console.log('ğŸ“§ Configuration:', {
            serviceId: EMAILJS_CONFIG.serviceId,
            templateId: EMAILJS_CONFIG.templateId,
            publicKey: EMAILJS_CONFIG.publicKey.substring(0, 5) + '...' // Show only first 5 chars for security
        });
    } else {
        console.error('âŒ EmailJS library not loaded!');
    }

    // Contact Form Handler
    const contactForm = document.getElementById('contact-form');
    if (contactForm) {
        contactForm.addEventListener('submit', function (e) {
            e.preventDefault();

            // Check if EmailJS is configured
            if (EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY') {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ EmailJS Ø£ÙˆÙ„Ø§Ù‹!\nPlease configure EmailJS first!\n\nØ§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª ÙÙŠ Ù…Ù„Ù: .agent/workflows/setup-emailjs.md');
                return;
            }

            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            const currentLang = localStorage.getItem('lang') || 'ar';

            // Disable button and show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Sending...';

            // Send email using EmailJS
            emailjs.sendForm(
                EMAILJS_CONFIG.serviceId,
                EMAILJS_CONFIG.templateId,
                this
            )
                .then(function (response) {
                    console.log('âœ… SUCCESS!', response.status, response.text);

                    // Success message
                    const successMsg = currentLang === 'ar'
                        ? 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.'
                        : 'âœ… Message sent successfully! I will contact you soon.';

                    alert(successMsg);

                    // Reset form
                    contactForm.reset();

                    // Re-enable button
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                })
                .catch(function (error) {
                    console.error('âŒ FAILED...', error);
                    console.error('Error details:', {
                        status: error.status,
                        text: error.text,
                        message: error.message
                    });

                    // Detailed error message
                    let errorDetails = '';
                    if (error.text) {
                        errorDetails = '\n\nØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£: ' + error.text;
                    }

                    // Error message
                    const errorMsg = currentLang === 'ar'
                        ? 'âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.' + errorDetails + '\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©.'
                        : 'âŒ Failed to send message.' + errorDetails + '\n\nPlease contact via email directly.';

                    alert(errorMsg);

                    // Re-enable button
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
        });
    }

    // --- Dynamic Blog Fetching ---
    async function loadBlogPosts() {
        const blogContainer = document.getElementById('blog-posts');
        if (!blogContainer) return;

        const currentLang = localStorage.getItem('lang') || 'ar';

        try {
            // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø¨ÙŠØ¦Ø© NetlifyØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª 
            // ÙˆÙ„ÙƒÙ† Ø§Ù„Ø¢Ù† Ø³Ù†Ù‚ÙˆÙ… Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ù…Ù„Ù Ø¹ÙŠÙ†Ø© Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„ÙÙƒØ±Ø©
            const response = await fetch('/blog/sample-post.md');
            if (!response.ok) throw new Error('No posts');

            const text = await response.text();

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ Frontmatter (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† ---)
            const frontmatterMatch = text.match(/^---([\s\S]*?)---/);
            if (frontmatterMatch) {
                const yamlData = frontmatterMatch[1];
                const title = yamlData.match(/title:\s*"(.*?)"/)?.[1] || 'No Title';
                const description = yamlData.match(/description:\s*"(.*?)"/)?.[1] || '';
                const date = yamlData.match(/date:\s*(.*?)\n/)?.[1] || '';

                blogContainer.innerHTML = `
                    <div class="project-card blog-card fade-in">
                        <div class="blog-date">${new Date(date).toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-US')}</div>
                        <h3>${title}</h3>
                        <p>${description}</p>
                        <a href="/blog/sample-post.md" class="project-link">${translations[currentLang].read_more}</a>
                    </div>
                `;
            }
        } catch (error) {
            console.log('Blog loading info:', error.message);
            blogContainer.innerHTML = `<p class="no-blogs">${translations[currentLang].no_blogs}</p>`;
        }
    }

    // Load blogs on start
    loadBlogPosts();
});
